var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));let l=require(`obsidian`);l=c(l);var u=class e{static logLevel=`silent`;constructor(e,t){this.scope=e,this.color=t}info=(...e)=>this.log(this.scope,`log`,...e);warn=(...e)=>this.log(this.scope,`warn`,...e);error=(...e)=>this.log(this.scope,`error`,...e);log(t,n=`log`,...r){if(e.logLevel===`silent`)return;let i=`color: ${this.color}; background: #212027; padding: 3px 3px; border-radius: 4px; font-size: 11px;`;console[n](`%c[ms/${t}]`,i,...r)}},d=class extends l.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){this.containerEl.empty(),new l.Setting(this.containerEl).setName(`New items position`).setDesc(`Position of newly created items in a folder.`).addDropdown(e=>e.addOption(`top`,`Top`).addOption(`bottom`,`Bottom`).setValue(this.plugin.settings.newItemsPosition).onChange(async e=>{this.plugin.settings.newItemsPosition=e,await this.plugin.saveSettings()})),new l.Setting(this.containerEl).setName(`Debug Mode`).setDesc(`Show debug logs in the console.`).addToggle(e=>e.setValue(this.plugin.settings.debugMode).onChange(async e=>{this.plugin.settings.debugMode=e,u.logLevel=e?`debug`:`silent`,await this.plugin.saveSettings()}))}},f=class extends l.Modal{constructor(e,t,n){super(e),this.setTitle(`Manual sorting`),this.modalEl.addClass(`manual-sorting-modal`);let r=this.contentEl.createEl(`div`);r.createEl(`p`,{text:`Reset custom order to match previously selected one (${t})?`});let i=r.createEl(`div`,{cls:`modal-buttons`});new l.ButtonComponent(i).setButtonText(`Yep`).setCta().onClick(()=>{this.close(),n()}),new l.ButtonComponent(i).setButtonText(`Cancel`).onClick(()=>{this.close()})}},p=class{log=new u(`order-manager`,`#ffd900`);constructor(e){this.plugin=e}resetOrder(){this.plugin.settings.customFileOrder={"/":[]},this.plugin.saveSettings()}updateOrder(){this.log.info(`Updating order...`);let e=this.getCurrentOrder(),t=this.plugin.settings.customFileOrder,n=this.matchSavedOrder(e,t);this.plugin.settings.customFileOrder=n,this.plugin.saveSettings(),this.log.info(`Order updated:`,this.plugin.settings.customFileOrder)}getCurrentOrder(){let e={},t=this.plugin.getFileExplorerView(),n=r=>{let i=t.getSortedFolderItems(r),a=i.map(e=>e.file.path);e[r.path]=a;for(let e of i){let t=e.file;t instanceof l.TFolder&&n(t)}};return n(this.plugin.app.vault.root),e}matchSavedOrder(e,t){let n={};for(let r in e)if(r in t){let i=t[r],a=e[r],o=i.filter(e=>a.includes(e)),s=a.filter(e=>!i.includes(e));this.plugin.settings.newItemsPosition===`top`?n[r]=Array.from(new Set([...s,...o])):n[r]=Array.from(new Set([...o,...s]))}else n[r]=Array.from(new Set(e[r]));return n}moveFile(e,t,n){this.log.info(`Moving from "${e}" to "${t}" at index ${n}`);let r=this.plugin.settings.customFileOrder,i=e.substring(0,e.lastIndexOf(`/`))||`/`,a=t.substring(0,t.lastIndexOf(`/`))||`/`;if(i in r?r[i]=r[i].filter(t=>t!==e):this.log.warn(`[moveFile] folder "${i}" not found in data.`),r[a].includes(t)){this.log.warn(`[moveFile] "${t}" already exists in "${a}". Removing it from "${i}" and returning.`);return}r[a].splice(n,0,t),this.plugin.saveSettings()}renameItem(e,t){if(e===t)return;this.log.info(`Renaming "${e}" to "${t}"`);let n=this.plugin.settings.customFileOrder,r=e.substring(0,e.lastIndexOf(`/`))||`/`;r in n?n[r]=n[r].map(n=>n===e?t:n):this.log.warn(`[renameItem] folder "${r}" not found in data.`),e in n&&(this.log.info(`[renameItem] "${e}" is a folder. Renaming its children as well.`),n[t]=n[e],delete n[e],n[t]=n[t].map(n=>n.replace(e,t))),this.plugin.saveSettings()}getFlattenPaths(){function e(t,n=`/`){let r=[];if(n in t)for(let i of t[n])r.push(i),i in t&&r.push(...e(t,i));return r}return e(this.plugin.settings.customFileOrder)}};const m=`manual-sorting`,h=.3,g=2,_={customFileOrder:{"/":[]},draggingEnabled:!0,selectedSortOrder:`manual-sorting`,debugMode:!1,newItemsPosition:`top`};function v(e,t){let n=Object.keys(t).map(n=>y(e,n,t[n]));return n.length===1?n[0]:function(){n.forEach(e=>e())}}function y(e,t,n){let r=e[t],i=e.hasOwnProperty(t),a=i?r:function(){return Object.getPrototypeOf(e)[t].apply(this,arguments)},o=n(a);return r&&Object.setPrototypeOf(o,r),Object.setPrototypeOf(s,o),e[t]=s,c;function s(...n){return o===a&&e[t]===s&&c(),o.apply(this,n)}function c(){e[t]===s&&(i?e[t]=a:delete e[t]),o!==a&&(o=a,Object.setPrototypeOf(s,r||Function))}}var b=o(((e,t)=>{
/*! Sortable 1.15.6 - MIT | git://github.com/SortableJS/Sortable.git */
(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n||=self).Sortable=r()})(e,function(){function e(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function t(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]==null?{}:arguments[n];n%2?e(Object(r),!0).forEach(function(e){var n=t,i;e=r[i=e],i in n?Object.defineProperty(n,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[i]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function n(e){return(n=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e})(e)}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(e==null)return{};var n,r=function(e,t){if(e==null)return{};for(var n,r={},i=Object.keys(e),a=0;a<i.length;a++)n=i[a],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),a=0;a<i.length;a++)n=i[a],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}(e)||function(e,t){if(e){if(typeof e==`string`)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return(n=n===`Object`&&e.constructor?e.constructor.name:n)===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function o(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e){if(typeof window<`u`&&window.navigator)return!!navigator.userAgent.match(e)}var c=s(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),l=s(/Edge/i),u=s(/firefox/i),d=s(/safari/i)&&!s(/chrome/i)&&!s(/android/i),f=s(/iP(ad|od|hone)/i),p=s(/chrome/i)&&s(/android/i),m={capture:!1,passive:!1};function h(e,t,n){e.addEventListener(t,n,!c&&m)}function g(e,t,n){e.removeEventListener(t,n,!c&&m)}function _(e,t){if(t&&(t[0]===`>`&&(t=t.substring(1)),e))try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return}}function v(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function y(e,t,n,r){if(e){n||=document;do if(t!=null&&(t[0]!==`>`||e.parentNode===n)&&_(e,t)||r&&e===n)return e;while(e!==n&&(e=v(e)))}return null}var b,ee=/\s+/g;function x(e,t,n){var r;e&&t&&(e.classList?e.classList[n?`add`:`remove`](t):(r=(` `+e.className+` `).replace(ee,` `).replace(` `+t+` `,` `),e.className=(r+(n?` `+t:``)).replace(ee,` `)))}function S(e,t,n){var r=e&&e.style;if(r){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,``):e.currentStyle&&(n=e.currentStyle),t===void 0?n:n[t];r[t=t in r||t.indexOf(`webkit`)!==-1?t:`-webkit-`+t]=n+(typeof n==`string`?``:`px`)}}function C(e,t){var n=``;if(typeof e==`string`)n=e;else do var r=S(e,`transform`);while(r&&r!==`none`&&(n=r+` `+n),!t&&(e=e.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(n)}function w(e,t,n){if(e){var r=e.getElementsByTagName(t),i=0,a=r.length;if(n)for(;i<a;i++)n(r[i],i);return r}return[]}function T(){return document.scrollingElement||document.documentElement}function E(e,t,n,r,i){if(e.getBoundingClientRect||e===window){var a,o,s,l,u,d,f=e!==window&&e.parentNode&&e!==T()?(o=(a=e.getBoundingClientRect()).top,s=a.left,l=a.bottom,u=a.right,d=a.height,a.width):(s=o=0,l=window.innerHeight,u=window.innerWidth,d=window.innerHeight,window.innerWidth);if((t||n)&&e!==window&&(i||=e.parentNode,!c))do if(i&&i.getBoundingClientRect&&(S(i,`transform`)!==`none`||n&&S(i,`position`)!==`static`)){var p=i.getBoundingClientRect();o-=p.top+parseInt(S(i,`border-top-width`)),s-=p.left+parseInt(S(i,`border-left-width`)),l=o+a.height,u=s+a.width;break}while(i=i.parentNode);return r&&e!==window&&(r=(t=C(i||e))&&t.a,e=t&&t.d,t&&(l=(o/=e)+(d/=e),u=(s/=r)+(f/=r))),{top:o,left:s,bottom:l,right:u,width:f,height:d}}}function D(e,t,n){for(var r=j(e,!0),i=E(e)[t];r;){var a=E(r)[n];if(!(n===`top`||n===`left`?a<=i:i<=a))return r;if(r===T())break;r=j(r,!1)}return!1}function O(e,t,n,r){for(var i=0,a=0,o=e.children;a<o.length;){if(o[a].style.display!==`none`&&o[a]!==q.ghost&&(r||o[a]!==q.dragged)&&y(o[a],n.draggable,e,!1)){if(i===t)return o[a];i++}a++}return null}function te(e,t){for(var n=e.lastElementChild;n&&(n===q.ghost||S(n,`display`)===`none`||t&&!_(n,t));)n=n.previousElementSibling;return n||null}function k(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()===`TEMPLATE`||e===q.clone||t&&!_(e,t)||n++;return n}function A(e){var t=0,n=0,r=T();if(e)do var i=C(e),a=i.a,i=i.d;while(t+=e.scrollLeft*a,n+=e.scrollTop*i,e!==r&&(e=e.parentNode));return[t,n]}function j(e,t){if(!e||!e.getBoundingClientRect)return T();var n=e,r=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=S(n);if(n.clientWidth<n.scrollWidth&&(i.overflowX==`auto`||i.overflowX==`scroll`)||n.clientHeight<n.scrollHeight&&(i.overflowY==`auto`||i.overflowY==`scroll`)){if(!n.getBoundingClientRect||n===document.body)return T();if(r||t)return n;r=!0}}while(n=n.parentNode);return T()}function M(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function ne(e,t){return function(){var n;b||=((n=arguments).length===1?e.call(this,n[0]):e.apply(this,n),setTimeout(function(){b=void 0},t))}}function re(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function N(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function ie(e,t){S(e,`position`,`absolute`),S(e,`top`,t.top),S(e,`left`,t.left),S(e,`width`,t.width),S(e,`height`,t.height)}function ae(e){S(e,`position`,``),S(e,`top`,``),S(e,`left`,``),S(e,`width`,``),S(e,`height`,``)}function oe(e,t,n){var r={};return Array.from(e.children).forEach(function(i){var a;y(i,t.draggable,e,!1)&&!i.animated&&i!==n&&(a=E(i),r.left=Math.min((i=r.left)??1/0,a.left),r.top=Math.min((i=r.top)??1/0,a.top),r.right=Math.max((i=r.right)??-1/0,a.right),r.bottom=Math.max((i=r.bottom)??-1/0,a.bottom))}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}var P=`Sortable`+new Date().getTime();function F(){var e,n=[];return{captureAnimationState:function(){n=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(e){var r,i;S(e,`display`)!==`none`&&e!==q.ghost&&(n.push({target:e,rect:E(e)}),r=t({},n[n.length-1].rect),!e.thisAnimationDuration||(i=C(e,!0))&&(r.top-=i.f,r.left-=i.e),e.fromRect=r)})},addAnimationState:function(e){n.push(e)},removeAnimationState:function(e){n.splice(function(e,t){for(var n in e)if(e.hasOwnProperty(n)){for(var r in t)if(t.hasOwnProperty(r)&&t[r]===e[n][r])return Number(n)}return-1}(n,{target:e}),1)},animateAll:function(t){var r=this;if(!this.options.animation)return clearTimeout(e),void(typeof t==`function`&&t());var i=!1,a=0;n.forEach(function(e){var t=0,n=e.target,o=n.fromRect,s=E(n),c=n.prevFromRect,l=n.prevToRect,u=e.rect,d=C(n,!0);d&&(s.top-=d.f,s.left-=d.e),n.toRect=s,n.thisAnimationDuration&&M(c,s)&&!M(o,s)&&(u.top-s.top)/(u.left-s.left)==(o.top-s.top)/(o.left-s.left)&&(e=u,d=c,c=l,l=r.options,t=Math.sqrt((d.top-e.top)**2+(d.left-e.left)**2)/Math.sqrt((d.top-c.top)**2+(d.left-c.left)**2)*l.animation),M(s,o)||(n.prevFromRect=o,n.prevToRect=s,t||=r.options.animation,r.animate(n,u,s,t)),t&&(i=!0,a=Math.max(a,t),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout(function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null},t),n.thisAnimationDuration=t)}),clearTimeout(e),i?e=setTimeout(function(){typeof t==`function`&&t()},a):typeof t==`function`&&t(),n=[]},animate:function(e,t,n,r){var i,a;r&&(S(e,`transition`,``),S(e,`transform`,``),i=(a=C(this.el))&&a.a,a&&=a.d,i=(t.left-n.left)/(i||1),a=(t.top-n.top)/(a||1),e.animatingX=!!i,e.animatingY=!!a,S(e,`transform`,`translate3d(`+i+`px,`+a+`px,0)`),this.forRepaintDummy=e.offsetWidth,S(e,`transition`,`transform `+r+`ms`+(this.options.easing?` `+this.options.easing:``)),S(e,`transform`,`translate3d(0,0,0)`),typeof e.animated==`number`&&clearTimeout(e.animated),e.animated=setTimeout(function(){S(e,`transition`,``),S(e,`transform`,``),e.animated=!1,e.animatingX=!1,e.animatingY=!1},r))}}}var se=[],ce={initializeByDefault:!0},le={mount:function(e){for(var t in ce)!ce.hasOwnProperty(t)||t in e||(e[t]=ce[t]);se.forEach(function(t){if(t.pluginName===e.pluginName)throw`Sortable: Cannot mount plugin ${e.pluginName} more than once`}),se.push(e)},pluginEvent:function(e,n,r){var i=this;this.eventCanceled=!1,r.cancel=function(){i.eventCanceled=!0};var a=e+`Global`;se.forEach(function(i){n[i.pluginName]&&(n[i.pluginName][a]&&n[i.pluginName][a](t({sortable:n},r)),n.options[i.pluginName]&&n[i.pluginName][e]&&n[i.pluginName][e](t({sortable:n},r)))})},initializePlugins:function(e,t,n,i){for(var a in se.forEach(function(i){var a=i.pluginName;(e.options[a]||i.initializeByDefault)&&((i=new i(e,t,e.options)).sortable=e,i.options=e.options,e[a]=i,r(n,i.defaults))}),e.options){var o;e.options.hasOwnProperty(a)&&(o=this.modifyOption(e,a,e.options[a]))!==void 0&&(e.options[a]=o)}},getEventProperties:function(e,t){var n={};return se.forEach(function(i){typeof i.eventProperties==`function`&&r(n,i.eventProperties.call(t[i.pluginName],e))}),n},modifyOption:function(e,t,n){var r;return se.forEach(function(i){e[i.pluginName]&&i.optionListeners&&typeof i.optionListeners[t]==`function`&&(r=i.optionListeners[t].call(e[i.pluginName],n))}),r}};function ue(e){var n=e.sortable,r=e.rootEl,i=e.name,a=e.targetEl,o=e.cloneEl,s=e.toEl,u=e.fromEl,d=e.oldIndex,f=e.newIndex,p=e.oldDraggableIndex,m=e.newDraggableIndex,h=e.originalEvent,g=e.putSortable,_=e.extraEventProperties;if(n||=r&&r[P]){var v,y=n.options,e=`on`+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||c||l?(v=document.createEvent(`Event`)).initEvent(i,!0,!0):v=new CustomEvent(i,{bubbles:!0,cancelable:!0}),v.to=s||r,v.from=u||r,v.item=a||r,v.clone=o,v.oldIndex=d,v.newIndex=f,v.oldDraggableIndex=p,v.newDraggableIndex=m,v.originalEvent=h,v.pullMode=g?g.lastPutMode:void 0;var b,ee=t(t({},_),le.getEventProperties(i,n));for(b in ee)v[b]=ee[b];r&&r.dispatchEvent(v),y[e]&&y[e].call(n,v)}}function I(e,n){var r=(a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{}).evt,a=i(a,de);le.pluginEvent.bind(q)(e,n,t({dragEl:R,parentEl:z,ghostEl:B,rootEl:V,nextEl:fe,lastDownEl:pe,cloneEl:H,cloneHidden:me,dragStarted:we,putSortable:W,activeSortable:q.active,originalEvent:r,oldIndex:he,oldDraggableIndex:ge,newIndex:U,newDraggableIndex:_e,hideGhostForTarget:Ue,unhideGhostForTarget:We,cloneNowHidden:function(){me=!0},cloneNowShown:function(){me=!1},dispatchSortableEvent:function(e){L({sortable:n,name:e,originalEvent:r})}},a))}var de=[`evt`];function L(e){ue(t({putSortable:W,cloneEl:H,targetEl:R,rootEl:V,oldIndex:he,oldDraggableIndex:ge,newIndex:U,newDraggableIndex:_e},e))}var R,z,B,V,fe,pe,H,me,he,U,ge,_e,ve,W,ye,G,be,xe,Se,Ce,we,Te,Ee,De,K,Oe=!1,ke=!1,Ae=[],je=!1,Me=!1,Ne=[],Pe=!1,Fe=[],Ie=typeof document<`u`,Le=f,Re=l||c?`cssFloat`:`float`,ze=Ie&&!p&&!f&&`draggable`in document.createElement(`div`),Be=function(){if(Ie){if(c)return!1;var e=document.createElement(`x`);return e.style.cssText=`pointer-events:auto`,e.style.pointerEvents===`auto`}}(),Ve=function(e,t){var n=S(e),r=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),i=O(e,0,t),a=O(e,1,t),o=i&&S(i),s=a&&S(a),c=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+E(i).width,e=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+E(a).width;return n.display===`flex`?n.flexDirection===`column`||n.flexDirection===`column-reverse`?`vertical`:`horizontal`:n.display===`grid`?n.gridTemplateColumns.split(` `).length<=1?`vertical`:`horizontal`:i&&o.float&&o.float!==`none`?(t=o.float===`left`?`left`:`right`,!a||s.clear!==`both`&&s.clear!==t?`horizontal`:`vertical`):i&&(o.display===`block`||o.display===`flex`||o.display===`table`||o.display===`grid`||r<=c&&n[Re]===`none`||a&&n[Re]===`none`&&r<c+e)?`vertical`:`horizontal`},He=function(e){function t(e,n){return function(r,i,a,o){var s=r.options.group.name&&i.options.group.name&&r.options.group.name===i.options.group.name;return e==null&&(n||s)?!0:e==null||!1===e?!1:n&&e===`clone`?e:typeof e==`function`?t(e(r,i,a,o),n)(r,i,a,o):(i=(n?r:i).options.group.name,!0===e||typeof e==`string`&&e===i||e.join&&-1<e.indexOf(i))}}var r={},i=e.group;i&&n(i)==`object`||(i={name:i}),r.name=i.name,r.checkPull=t(i.pull,!0),r.checkPut=t(i.put),r.revertClone=i.revertClone,e.group=r},Ue=function(){!Be&&B&&S(B,`display`,`none`)},We=function(){!Be&&B&&S(B,`display`,``)};Ie&&!p&&document.addEventListener(`click`,function(e){if(ke)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),ke=!1},!0);function Ge(e){if(R){e=e.touches?e.touches[0]:e;var t=(i=e.clientX,a=e.clientY,Ae.some(function(e){var t=e[P].options.emptyInsertThreshold;if(t&&!te(e)){var n=E(e),r=i>=n.left-t&&i<=n.right+t,t=a>=n.top-t&&a<=n.bottom+t;return r&&t?o=e:void 0}}),o);if(t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);r.target=r.rootEl=t,r.preventDefault=void 0,r.stopPropagation=void 0,t[P]._onDragOver(r)}}var i,a,o}function Ke(e){R&&R.parentNode[P]._isOutsideThisEl(e.target)}function q(e,t){if(!e||!e.nodeType||e.nodeType!==1)throw`Sortable: \`el\` must be an HTMLElement, not ${{}.toString.call(e)}`;this.el=e,this.options=t=r({},t),e[P]=this;var n,i,a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?`>li`:`>*`,swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ve(e,this.options)},ghostClass:`sortable-ghost`,chosenClass:`sortable-chosen`,dragClass:`sortable-drag`,ignore:`a, img`,filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData(`Text`,t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:`data-id`,delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:`sortable-fallback`,fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==q.supportPointer&&`PointerEvent`in window&&(!d||f),emptyInsertThreshold:5};for(n in le.initializePlugins(this,e,a),a)n in t||(t[n]=a[n]);for(i in He(t),this)i.charAt(0)===`_`&&typeof this[i]==`function`&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&ze,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?h(e,`pointerdown`,this._onTapStart):(h(e,`mousedown`,this._onTapStart),h(e,`touchstart`,this._onTapStart)),this.nativeDraggable&&(h(e,`dragover`,this),h(e,`dragenter`,this)),Ae.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),r(this,F())}function qe(e,t,n,r,i,a,o,s){var u,d,f=e[P],p=f.options.onMove;return!window.CustomEvent||c||l?(u=document.createEvent(`Event`)).initEvent(`move`,!0,!0):u=new CustomEvent(`move`,{bubbles:!0,cancelable:!0}),u.to=t,u.from=e,u.dragged=n,u.draggedRect=r,u.related=i||t,u.relatedRect=a||E(t),u.willInsertAfter=s,u.originalEvent=o,e.dispatchEvent(u),d=p?p.call(f,u,o):d}function Je(e){e.draggable=!1}function Ye(){Pe=!1}function Xe(e){return setTimeout(e,0)}function Ze(e){return clearTimeout(e)}q.prototype={constructor:q,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Te=null)},_getDirection:function(e,t){return typeof this.options.direction==`function`?this.options.direction.call(this,e,t,R):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,r=this.options,i=r.preventOnFilter,a=e.type,o=e.touches&&e.touches[0]||e.pointerType&&e.pointerType===`touch`&&e,s=(o||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,l=r.filter;if(function(e){Fe.length=0;for(var t=e.getElementsByTagName(`input`),n=t.length;n--;){var r=t[n];r.checked&&Fe.push(r)}}(n),!R&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||r.disabled)&&!c.isContentEditable&&(this.nativeDraggable||!d||!s||s.tagName.toUpperCase()!==`SELECT`)&&!((s=y(s,r.draggable,n,!1))&&s.animated||pe===s)){if(he=k(s),ge=k(s,r.draggable),typeof l==`function`){if(l.call(this,e,s,this))return L({sortable:t,rootEl:c,name:`filter`,targetEl:s,toEl:n,fromEl:n}),I(`filter`,t,{evt:e}),void(i&&e.preventDefault())}else if(l&&=l.split(`,`).some(function(r){if(r=y(c,r.trim(),n,!1))return L({sortable:t,rootEl:r,name:`filter`,targetEl:s,fromEl:n,toEl:n}),I(`filter`,t,{evt:e}),!0}))return void(i&&e.preventDefault());r.handle&&!y(c,r.handle,n,!1)||this._prepareDragStart(e,o,s)}}},_prepareDragStart:function(e,t,n){var r,i=this,a=i.el,o=i.options,s=a.ownerDocument;n&&!R&&n.parentNode===a&&(r=E(n),V=a,z=(R=n).parentNode,fe=R.nextSibling,pe=n,ve=o.group,ye={target:q.dragged=R,clientX:(t||e).clientX,clientY:(t||e).clientY},Se=ye.clientX-r.left,Ce=ye.clientY-r.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,R.style[`will-change`]=`all`,r=function(){I(`delayEnded`,i,{evt:e}),q.eventCanceled?i._onDrop():(i._disableDelayedDragEvents(),!u&&i.nativeDraggable&&(R.draggable=!0),i._triggerDragStart(e,t),L({sortable:i,name:`choose`,originalEvent:e}),x(R,o.chosenClass,!0))},o.ignore.split(`,`).forEach(function(e){w(R,e.trim(),Je)}),h(s,`dragover`,Ge),h(s,`mousemove`,Ge),h(s,`touchmove`,Ge),o.supportPointer?(h(s,`pointerup`,i._onDrop),this.nativeDraggable||h(s,`pointercancel`,i._onDrop)):(h(s,`mouseup`,i._onDrop),h(s,`touchend`,i._onDrop),h(s,`touchcancel`,i._onDrop)),u&&this.nativeDraggable&&(this.options.touchStartThreshold=4,R.draggable=!0),I(`delayStart`,this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(l||c)?r():q.eventCanceled?this._onDrop():(o.supportPointer?(h(s,`pointerup`,i._disableDelayedDrag),h(s,`pointercancel`,i._disableDelayedDrag)):(h(s,`mouseup`,i._disableDelayedDrag),h(s,`touchend`,i._disableDelayedDrag),h(s,`touchcancel`,i._disableDelayedDrag)),h(s,`mousemove`,i._delayedDragTouchMoveHandler),h(s,`touchmove`,i._delayedDragTouchMoveHandler),o.supportPointer&&h(s,`pointermove`,i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(r,o.delay)))},_delayedDragTouchMoveHandler:function(e){e=e.touches?e.touches[0]:e,Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){R&&Je(R),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;g(e,`mouseup`,this._disableDelayedDrag),g(e,`touchend`,this._disableDelayedDrag),g(e,`touchcancel`,this._disableDelayedDrag),g(e,`pointerup`,this._disableDelayedDrag),g(e,`pointercancel`,this._disableDelayedDrag),g(e,`mousemove`,this._delayedDragTouchMoveHandler),g(e,`touchmove`,this._delayedDragTouchMoveHandler),g(e,`pointermove`,this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t||=e.pointerType==`touch`&&e,!this.nativeDraggable||t?this.options.supportPointer?h(document,`pointermove`,this._onTouchMove):h(document,t?`touchmove`:`mousemove`,this._onTouchMove):(h(R,`dragend`,this),h(V,`dragstart`,this._onDragStart));try{document.selection?Xe(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){var n;Oe=!1,V&&R?(I(`dragStarted`,this,{evt:t}),this.nativeDraggable&&h(document,`dragover`,Ke),n=this.options,e||x(R,n.dragClass,!1),x(R,n.ghostClass,!0),q.active=this,e&&this._appendGhost(),L({sortable:this,name:`start`,originalEvent:t})):this._nulling()},_emulateDragOver:function(){if(G){this._lastX=G.clientX,this._lastY=G.clientY,Ue();for(var e=document.elementFromPoint(G.clientX,G.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(G.clientX,G.clientY))!==t;)t=e;if(R.parentNode[P]._isOutsideThisEl(e),t)do if(t[P]&&t[P]._onDragOver({clientX:G.clientX,clientY:G.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;while(t=v(e=t));We()}},_onTouchMove:function(e){if(ye){var t=this.options,n=t.fallbackTolerance,r=t.fallbackOffset,i=e.touches?e.touches[0]:e,a=B&&C(B,!0),o=B&&a&&a.a,s=B&&a&&a.d,t=Le&&K&&A(K),o=(i.clientX-ye.clientX+r.x)/(o||1)+(t?t[0]-Ne[0]:0)/(o||1),s=(i.clientY-ye.clientY+r.y)/(s||1)+(t?t[1]-Ne[1]:0)/(s||1);if(!q.active&&!Oe){if(n&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}B&&(a?(a.e+=o-(be||0),a.f+=s-(xe||0)):a={a:1,b:0,c:0,d:1,e:o,f:s},a=`matrix(${a.a},${a.b},${a.c},${a.d},${a.e},${a.f})`,S(B,`webkitTransform`,a),S(B,`mozTransform`,a),S(B,`msTransform`,a),S(B,`transform`,a),be=o,xe=s,G=i),e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!B){var e=this.options.fallbackOnBody?document.body:V,t=E(R,!0,Le,!0,e),n=this.options;if(Le){for(K=e;S(K,`position`)===`static`&&S(K,`transform`)===`none`&&K!==document;)K=K.parentNode;K!==document.body&&K!==document.documentElement?(K===document&&(K=T()),t.top+=K.scrollTop,t.left+=K.scrollLeft):K=T(),Ne=A(K)}x(B=R.cloneNode(!0),n.ghostClass,!1),x(B,n.fallbackClass,!0),x(B,n.dragClass,!0),S(B,`transition`,``),S(B,`transform`,``),S(B,`box-sizing`,`border-box`),S(B,`margin`,0),S(B,`top`,t.top),S(B,`left`,t.left),S(B,`width`,t.width),S(B,`height`,t.height),S(B,`opacity`,`0.8`),S(B,`position`,Le?`absolute`:`fixed`),S(B,`zIndex`,`100000`),S(B,`pointerEvents`,`none`),q.ghost=B,e.appendChild(B),S(B,`transform-origin`,Se/parseInt(B.style.width)*100+`% `+Ce/parseInt(B.style.height)*100+`%`)}},_onDragStart:function(e,t){var n=this,r=e.dataTransfer,i=n.options;I(`dragStart`,this,{evt:e}),q.eventCanceled?this._onDrop():(I(`setupClone`,this),q.eventCanceled||((H=N(R)).removeAttribute(`id`),H.draggable=!1,H.style[`will-change`]=``,this._hideClone(),x(H,this.options.chosenClass,!1),q.clone=H),n.cloneId=Xe(function(){I(`clone`,n),q.eventCanceled||(n.options.removeCloneOnHide||V.insertBefore(H,R),n._hideClone(),L({sortable:n,name:`clone`}))}),t||x(R,i.dragClass,!0),t?(ke=!0,n._loopId=setInterval(n._emulateDragOver,50)):(g(document,`mouseup`,n._onDrop),g(document,`touchend`,n._onDrop),g(document,`touchcancel`,n._onDrop),r&&(r.effectAllowed=`move`,i.setData&&i.setData.call(n,r,R)),h(document,`drop`,n),S(R,`transform`,`translateZ(0)`)),Oe=!0,n._dragStartId=Xe(n._dragStarted.bind(n,t,e)),h(document,`selectstart`,n),we=!0,window.getSelection().removeAllRanges(),d&&S(document.body,`user-select`,`none`))},_onDragOver:function(e){var n,r,i,a,o,s=this.el,c=e.target,l=this.options,u=l.group,d=q.active,f=ve===u,p=l.sort,m=W||d,h=this,g=!1;if(!Pe){if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),c=y(c,l.draggable,s,!0),ie(`dragOver`),q.eventCanceled)return g;if(R.contains(e.target)||c.animated&&c.animatingX&&c.animatingY||h._ignoreWhileAnimating===c)return F(!1);if(ke=!1,d&&!l.disabled&&(f?p||(r=z!==V):W===this||(this.lastPutMode=ve.checkPull(this,d,R,e))&&u.checkPut(this,d,R,e))){if(i=this._getDirection(e,c)===`vertical`,n=E(R),ie(`dragOverValid`),q.eventCanceled)return g;if(r)return z=V,ae(),this._hideClone(),ie(`revert`),q.eventCanceled||(fe?V.insertBefore(R,fe):V.appendChild(R)),F(!0);var _=te(s,l.draggable);if(_&&(A=e,u=i,N=E(te((T=this).el,T.options.draggable)),T=oe(T.el,T.options,B),!(u?A.clientX>T.right+10||A.clientY>N.bottom&&A.clientX>N.left:A.clientY>T.bottom+10||A.clientX>N.right&&A.clientY>N.top)||_.animated)){if(_&&(a=e,o=i,M=E(O((j=this).el,0,j.options,!0)),j=oe(j.el,j.options,B),o?a.clientX<j.left-10||a.clientY<M.top&&a.clientX<M.right:a.clientY<j.top-10||a.clientY<M.bottom&&a.clientX<M.left)){var v=O(s,0,l,!0);if(v===R)return F(!1);if(w=E(c=v),!1!==qe(V,s,R,n,c,w,e,!1))return ae(),s.insertBefore(R,v),z=s,se(),F(!0)}else if(c.parentNode===s){var b,ee,C,w=E(c),T=R.parentNode!==s,A=(A=R.animated&&R.toRect||n,N=c.animated&&c.toRect||w,j=(o=i)?A.left:A.top,a=o?A.right:A.bottom,M=o?A.width:A.height,v=o?N.left:N.top,A=o?N.right:N.bottom,N=o?N.width:N.height,!(j===v||a===A||j+M/2===v+N/2)),j=i?`top`:`left`,M=D(c,`top`,`top`)||D(R,`top`,`top`),v=M?M.scrollTop:void 0;if(Te!==c&&(ee=w[j],je=!1,Me=!A&&l.invertSwap||T),(b=function(e,t,n,r,i,a,o,s){var c=r?e.clientY:e.clientX,l=r?n.height:n.width,e=r?n.top:n.left,r=r?n.bottom:n.right,n=!1;if(!o){if(s&&De<l*i){if(je=!je&&(Ee===1?e+l*a/2<c:c<r-l*a/2)?!0:je)n=!0;else if(Ee===1?c<e+De:r-De<c)return-Ee}else if(e+l*(1-i)/2<c&&c<r-l*(1-i)/2)return function(e){return k(R)<k(e)?1:-1}(t)}return(n||=o)&&(c<e+l*a/2||r-l*a/2<c)?e+l/2<c?1:-1:0}(e,c,w,i,A?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,Me,Te===c))!==0)for(var ne=k(R);(C=z.children[ne-=b])&&(S(C,`display`)===`none`||C===B););if(b===0||C===c)return F(!1);Ee=b;var N=(Te=c).nextElementSibling,T=!1,A=qe(V,s,R,n,c,w,e,T=b===1);if(!1!==A)return A!==1&&A!==-1||(T=A===1),Pe=!0,setTimeout(Ye,30),ae(),T&&!N?s.appendChild(R):c.parentNode.insertBefore(R,T?N:c),M&&re(M,0,v-M.scrollTop),z=R.parentNode,ee===void 0||Me||(De=Math.abs(ee-E(c)[j])),se(),F(!0)}}else{if(_===R)return F(!1);if((c=_&&s===e.target?_:c)&&(w=E(c)),!1!==qe(V,s,R,n,c,w,e,!!c))return ae(),_&&_.nextSibling?s.insertBefore(R,_.nextSibling):s.appendChild(R),z=s,se(),F(!0)}if(s.contains(R))return F(!1)}return!1}function ie(a,o){I(a,h,t({evt:e,isOwner:f,axis:i?`vertical`:`horizontal`,revert:r,dragRect:n,targetRect:w,canSort:p,fromSortable:m,target:c,completed:F,onMove:function(t,r){return qe(V,s,R,n,t,E(t),e,r)},changed:se},o))}function ae(){ie(`dragOverAnimationCapture`),h.captureAnimationState(),h!==m&&m.captureAnimationState()}function F(t){return ie(`dragOverCompleted`,{insertion:t}),t&&(f?d._hideClone():d._showClone(h),h!==m&&(x(R,(W||d).options.ghostClass,!1),x(R,l.ghostClass,!0)),W!==h&&h!==q.active?W=h:h===q.active&&W&&(W=null),m===h&&(h._ignoreWhileAnimating=c),h.animateAll(function(){ie(`dragOverAnimationComplete`),h._ignoreWhileAnimating=null}),h!==m&&(m.animateAll(),m._ignoreWhileAnimating=null)),(c===R&&!R.animated||c===s&&!c.animated)&&(Te=null),l.dragoverBubble||e.rootEl||c===document||(R.parentNode[P]._isOutsideThisEl(e.target),t||Ge(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function se(){U=k(R),_e=k(R,l.draggable),L({sortable:h,name:`change`,toEl:s,newIndex:U,newDraggableIndex:_e,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){g(document,`mousemove`,this._onTouchMove),g(document,`touchmove`,this._onTouchMove),g(document,`pointermove`,this._onTouchMove),g(document,`dragover`,Ge),g(document,`mousemove`,Ge),g(document,`touchmove`,Ge)},_offUpEvents:function(){var e=this.el.ownerDocument;g(e,`mouseup`,this._onDrop),g(e,`touchend`,this._onDrop),g(e,`pointerup`,this._onDrop),g(e,`pointercancel`,this._onDrop),g(e,`touchcancel`,this._onDrop),g(document,`selectstart`,this)},_onDrop:function(e){var t=this.el,n=this.options;U=k(R),_e=k(R,n.draggable),I(`drop`,this,{evt:e}),z=R&&R.parentNode,U=k(R),_e=k(R,n.draggable),q.eventCanceled||(je=Me=Oe=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ze(this.cloneId),Ze(this._dragStartId),this.nativeDraggable&&(g(document,`drop`,this),g(t,`dragstart`,this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),d&&S(document.body,`user-select`,``),S(R,`transform`,``),e&&(we&&(e.cancelable&&e.preventDefault(),n.dropBubble||e.stopPropagation()),B&&B.parentNode&&B.parentNode.removeChild(B),(V===z||W&&W.lastPutMode!==`clone`)&&H&&H.parentNode&&H.parentNode.removeChild(H),R&&(this.nativeDraggable&&g(R,`dragend`,this),Je(R),R.style[`will-change`]=``,we&&!Oe&&x(R,(W||this).options.ghostClass,!1),x(R,this.options.chosenClass,!1),L({sortable:this,name:`unchoose`,toEl:z,newIndex:null,newDraggableIndex:null,originalEvent:e}),V===z?U!==he&&0<=U&&(L({sortable:this,name:`update`,toEl:z,originalEvent:e}),L({sortable:this,name:`sort`,toEl:z,originalEvent:e})):(0<=U&&(L({rootEl:z,name:`add`,toEl:z,fromEl:V,originalEvent:e}),L({sortable:this,name:`remove`,toEl:z,originalEvent:e}),L({rootEl:z,name:`sort`,toEl:z,fromEl:V,originalEvent:e}),L({sortable:this,name:`sort`,toEl:z,originalEvent:e})),W&&W.save()),q.active&&(U!=null&&U!==-1||(U=he,_e=ge),L({sortable:this,name:`end`,toEl:z,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){I(`nulling`,this),V=R=z=B=fe=H=pe=me=ye=G=we=U=_e=he=ge=Te=Ee=W=ve=q.dragged=q.ghost=q.clone=q.active=null,Fe.forEach(function(e){e.checked=!0}),Fe.length=be=xe=0},handleEvent:function(e){switch(e.type){case`drop`:case`dragend`:this._onDrop(e);break;case`dragenter`:case`dragover`:R&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect=`move`),e.cancelable&&e.preventDefault()}(e));break;case`selectstart`:e.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,r=0,i=n.length,a=this.options;r<i;r++)y(e=n[r],a.draggable,this.el,!1)&&t.push(e.getAttribute(a.dataIdAttr)||function(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,r=0;n--;)r+=t.charCodeAt(n);return r.toString(36)}(e));return t},sort:function(e,t){var n={},r=this.el;this.toArray().forEach(function(e,t){t=r.children[t],y(t,this.options.draggable,r,!1)&&(n[e]=t)},this),t&&this.captureAnimationState(),e.forEach(function(e){n[e]&&(r.removeChild(n[e]),r.appendChild(n[e]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return y(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var r=le.modifyOption(this,e,t);n[e]=r===void 0?t:r,e===`group`&&He(n)},destroy:function(){I(`destroy`,this);var e=this.el;e[P]=null,g(e,`mousedown`,this._onTapStart),g(e,`touchstart`,this._onTapStart),g(e,`pointerdown`,this._onTapStart),this.nativeDraggable&&(g(e,`dragover`,this),g(e,`dragenter`,this)),Array.prototype.forEach.call(e.querySelectorAll(`[draggable]`),function(e){e.removeAttribute(`draggable`)}),this._onDrop(),this._disableDelayedDragEvents(),Ae.splice(Ae.indexOf(this.el),1),this.el=e=null},_hideClone:function(){me||(I(`hideClone`,this),q.eventCanceled||(S(H,`display`,`none`),this.options.removeCloneOnHide&&H.parentNode&&H.parentNode.removeChild(H),me=!0))},_showClone:function(e){e.lastPutMode===`clone`?me&&(I(`showClone`,this),q.eventCanceled||(R.parentNode!=V||this.options.group.revertClone?fe?V.insertBefore(H,fe):V.appendChild(H):V.insertBefore(H,R),this.options.group.revertClone&&this.animate(R,H),S(H,`display`,``),me=!1)):this._hideClone()}},Ie&&h(document,`touchmove`,function(e){(q.active||Oe)&&e.cancelable&&e.preventDefault()}),q.utils={on:h,off:g,css:S,find:w,is:function(e,t){return!!y(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},throttle:ne,closest:y,toggleClass:x,clone:N,index:k,nextTick:Xe,cancelNextTick:Ze,detectDirection:Ve,getChild:O,expando:P},q.get=function(e){return e[P]},q.mount=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];(n=n[0].constructor===Array?n[0]:n).forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw`Sortable: Mounted plugin must be a constructor function, not ${{}.toString.call(e)}`;e.utils&&(q.utils=t(t({},q.utils),e.utils)),le.mount(e)})},q.create=function(e,t){return new q(e,t)};var Qe,$e,et,tt,nt,rt,J=[],it=!(q.version=`1.15.6`);function at(){J.forEach(function(e){clearInterval(e.pid)}),J=[]}function ot(){clearInterval(rt)}var st,ct=ne(function(e,t,n,r){if(t.scroll){var i,a=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,c=t.scrollSpeed,l=T(),u=!1;$e!==n&&($e=n,at(),Qe=t.scroll,i=t.scrollFn,!0===Qe&&(Qe=j(n,!0)));var d=0,f=Qe;do{var p=f,m=E(p),h=m.top,g=m.bottom,_=m.left,v=m.right,y=m.width,b=m.height,ee=void 0,x=void 0,C=p.scrollWidth,w=p.scrollHeight,D=S(p),O=p.scrollLeft,m=p.scrollTop,x=p===l?(ee=y<C&&(D.overflowX===`auto`||D.overflowX===`scroll`||D.overflowX===`visible`),b<w&&(D.overflowY===`auto`||D.overflowY===`scroll`||D.overflowY===`visible`)):(ee=y<C&&(D.overflowX===`auto`||D.overflowX===`scroll`),b<w&&(D.overflowY===`auto`||D.overflowY===`scroll`)),O=ee&&(Math.abs(v-a)<=s&&O+y<C)-(Math.abs(_-a)<=s&&!!O),m=x&&(Math.abs(g-o)<=s&&m+b<w)-(Math.abs(h-o)<=s&&!!m);if(!J[d])for(var te=0;te<=d;te++)J[te]||(J[te]={});J[d].vx==O&&J[d].vy==m&&J[d].el===p||(J[d].el=p,J[d].vx=O,J[d].vy=m,clearInterval(J[d].pid),O==0&&m==0||(u=!0,J[d].pid=setInterval(function(){r&&this.layer===0&&q.active._onTouchMove(nt);var t=J[this.layer].vy?J[this.layer].vy*c:0,n=J[this.layer].vx?J[this.layer].vx*c:0;typeof i==`function`&&i.call(q.dragged.parentNode[P],n,t,e,nt,J[this.layer].el)!==`continue`||re(J[this.layer].el,n,t)}.bind({layer:d}),24))),d++}while(t.bubbleScroll&&f!==l&&(f=j(f,!1)));it=u}},30),p=function(e){var t=e.originalEvent,n=e.putSortable,r=e.dragEl,i=e.activeSortable,a=e.dispatchSortableEvent,o=e.hideGhostForTarget,e=e.unhideGhostForTarget;t&&(i=n||i,o(),t=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,t=document.elementFromPoint(t.clientX,t.clientY),e(),i&&!i.el.contains(t)&&(a(`spill`),this.onSpill({dragEl:r,putSortable:n})))};function lt(){}function ut(){}lt.prototype={startIndex:null,dragStart:function(e){e=e.oldDraggableIndex,this.startIndex=e},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState(),e=O(this.sortable.el,this.startIndex,this.options),e?this.sortable.el.insertBefore(t,e):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:p},r(lt,{pluginName:`revertOnSpill`}),ut.prototype={onSpill:function(e){var t=e.dragEl,e=e.putSortable||this.sortable;e.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),e.animateAll()},drop:p},r(ut,{pluginName:`removeOnSpill`});var dt,Y,X,ft,pt,Z=[],Q=[],mt=!1,$=!1,ht=!1;function gt(e,t){Q.forEach(function(n,r){r=t.children[n.sortableIndex+(e?Number(r):0)],r?t.insertBefore(n,r):t.appendChild(n)})}function _t(){Z.forEach(function(e){e!==X&&e.parentNode&&e.parentNode.removeChild(e)})}return q.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)e.charAt(0)===`_`&&typeof this[e]==`function`&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){e=e.originalEvent,this.sortable.nativeDraggable?h(document,`dragover`,this._handleAutoScroll):this.options.supportPointer?h(document,`pointermove`,this._handleFallbackAutoScroll):e.touches?h(document,`touchmove`,this._handleFallbackAutoScroll):h(document,`mousemove`,this._handleFallbackAutoScroll)},dragOverCompleted:function(e){e=e.originalEvent,this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?g(document,`dragover`,this._handleAutoScroll):(g(document,`pointermove`,this._handleFallbackAutoScroll),g(document,`touchmove`,this._handleFallbackAutoScroll),g(document,`mousemove`,this._handleFallbackAutoScroll)),ot(),at(),clearTimeout(b),b=void 0},nulling:function(){nt=$e=Qe=it=rt=et=tt=null,J.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n,r=this,i=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(i,a);nt=e,t||this.options.forceAutoScrollFallback||l||c||d?(ct(e,this.options,o,t),n=j(o,!0),!it||rt&&i===et&&a===tt||(rt&&ot(),rt=setInterval(function(){var o=j(document.elementFromPoint(i,a),!0);o!==n&&(n=o,at()),ct(e,r.options,o,t)},10),et=i,tt=a)):this.options.bubbleScroll&&j(o,!0)!==T()?ct(e,this.options,j(o,!1),!1):at()}},r(e,{pluginName:`scroll`,initializeByDefault:!0})}),q.mount(ut,lt),q.mount(new function(){function e(){this.defaults={swapClass:`sortable-swap-highlight`}}return e.prototype={dragStart:function(e){e=e.dragEl,st=e},dragOverValid:function(e){var t=e.completed,n=e.target,r=e.onMove,i=e.activeSortable,a=e.changed,o=e.cancel;i.options.swap&&(e=this.sortable.el,i=this.options,n&&n!==e&&(e=st,st=!1===r(n)?null:(x(n,i.swapClass,!0),n),e&&e!==st&&x(e,i.swapClass,!1)),a(),t(!0),o())},drop:function(e){var t,n,r=e.activeSortable,i=e.putSortable,a=e.dragEl,o=i||this.sortable,s=this.options;st&&x(st,s.swapClass,!1),st&&(s.swap||i&&i.options.swap)&&a!==st&&(o.captureAnimationState(),o!==r&&r.captureAnimationState(),n=st,e=(t=a).parentNode,s=n.parentNode,e&&s&&!e.isEqualNode(n)&&!s.isEqualNode(t)&&(i=k(t),a=k(n),e.isEqualNode(s)&&i<a&&a++,e.insertBefore(n,e.children[i]),s.insertBefore(t,s.children[a])),o.animateAll(),o!==r&&r.animateAll())},nulling:function(){st=null}},r(e,{pluginName:`swap`,eventProperties:function(){return{swapItem:st}}})}),q.mount(new function(){function e(e){for(var t in this)t.charAt(0)===`_`&&typeof this[t]==`function`&&(this[t]=this[t].bind(this));e.options.avoidImplicitDeselect||(e.options.supportPointer?h(document,`pointerup`,this._deselectMultiDrag):(h(document,`mouseup`,this._deselectMultiDrag),h(document,`touchend`,this._deselectMultiDrag))),h(document,`keydown`,this._checkKeyDown),h(document,`keyup`,this._checkKeyUp),this.defaults={selectedClass:`sortable-selected`,multiDragKey:null,avoidImplicitDeselect:!1,setData:function(t,n){var r=``;Z.length&&Y===e?Z.forEach(function(e,t){r+=(t?`, `:``)+e.textContent}):r=n.textContent,t.setData(`Text`,r)}}}return e.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(e){e=e.dragEl,X=e},delayEnded:function(){this.isMultiDrag=~Z.indexOf(X)},setupClone:function(e){var t=e.sortable,e=e.cancel;if(this.isMultiDrag){for(var n=0;n<Z.length;n++)Q.push(N(Z[n])),Q[n].sortableIndex=Z[n].sortableIndex,Q[n].draggable=!1,Q[n].style[`will-change`]=``,x(Q[n],this.options.selectedClass,!1),Z[n]===X&&x(Q[n],this.options.chosenClass,!1);t._hideClone(),e()}},clone:function(e){var t=e.sortable,n=e.rootEl,r=e.dispatchSortableEvent,e=e.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||Z.length&&Y===t&&(gt(!0,n),r(`clone`),e()))},showClone:function(e){var t=e.cloneNowShown,n=e.rootEl,e=e.cancel;this.isMultiDrag&&(gt(!1,n),Q.forEach(function(e){S(e,`display`,``)}),t(),pt=!1,e())},hideClone:function(e){var t=this,n=(e.sortable,e.cloneNowHidden),e=e.cancel;this.isMultiDrag&&(Q.forEach(function(e){S(e,`display`,`none`),t.options.removeCloneOnHide&&e.parentNode&&e.parentNode.removeChild(e)}),n(),pt=!0,e())},dragStartGlobal:function(e){e.sortable,!this.isMultiDrag&&Y&&Y.multiDrag._deselectMultiDrag(),Z.forEach(function(e){e.sortableIndex=k(e)}),Z=Z.sort(function(e,t){return e.sortableIndex-t.sortableIndex}),ht=!0},dragStarted:function(e){var t,n=this,e=e.sortable;this.isMultiDrag&&(this.options.sort&&(e.captureAnimationState(),this.options.animation&&(Z.forEach(function(e){e!==X&&S(e,`position`,`absolute`)}),t=E(X,!1,!0,!0),Z.forEach(function(e){e!==X&&ie(e,t)}),mt=$=!0)),e.animateAll(function(){mt=$=!1,n.options.animation&&Z.forEach(function(e){ae(e)}),n.options.sort&&_t()}))},dragOver:function(e){var t=e.target,n=e.completed,e=e.cancel;$&&~Z.indexOf(t)&&(n(!1),e())},revert:function(e){var t,n,r=e.fromSortable,i=e.rootEl,a=e.sortable,o=e.dragRect;1<Z.length&&(Z.forEach(function(e){a.addAnimationState({target:e,rect:$?E(e):o}),ae(e),e.fromRect=o,r.removeAnimationState(e)}),$=!1,t=!this.options.removeCloneOnHide,n=i,Z.forEach(function(e,r){r=n.children[e.sortableIndex+(t?Number(r):0)],r?n.insertBefore(e,r):n.appendChild(e)}))},dragOverCompleted:function(e){var t,n=e.sortable,r=e.isOwner,i=e.insertion,a=e.activeSortable,o=e.parentEl,s=e.putSortable,e=this.options;i&&(r&&a._hideClone(),mt=!1,e.animation&&1<Z.length&&($||!r&&!a.options.sort&&!s)&&(t=E(X,!1,!0,!0),Z.forEach(function(e){e!==X&&(ie(e,t),o.appendChild(e))}),$=!0),r||($||_t(),1<Z.length?(r=pt,a._showClone(n),a.options.animation&&!pt&&r&&Q.forEach(function(e){a.addAnimationState({target:e,rect:ft}),e.fromRect=ft,e.thisAnimationDuration=null})):a._showClone(n)))},dragOverAnimationCapture:function(e){var t=e.dragRect,n=e.isOwner,e=e.activeSortable;Z.forEach(function(e){e.thisAnimationDuration=null}),e.options.animation&&!n&&e.multiDrag.isMultiDrag&&(ft=r({},t),t=C(X,!0),ft.top-=t.f,ft.left-=t.e)},dragOverAnimationComplete:function(){$&&($=!1,_t())},drop:function(e){var t,n,r,i,a,o,s,c=e.originalEvent,l=e.rootEl,u=e.parentEl,d=e.sortable,f=e.dispatchSortableEvent,p=e.oldIndex,e=e.putSortable,m=e||this.sortable;c&&(t=this.options,n=u.children,ht||(t.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),x(X,t.selectedClass,!~Z.indexOf(X)),~Z.indexOf(X)?(Z.splice(Z.indexOf(X),1),dt=null,ue({sortable:d,rootEl:l,name:`deselect`,targetEl:X,originalEvent:c})):(Z.push(X),ue({sortable:d,rootEl:l,name:`select`,targetEl:X,originalEvent:c}),c.shiftKey&&dt&&d.el.contains(dt)?(r=k(dt),i=k(X),~r&&~i&&r!==i&&function(){for(var e,a=r<i?(e=r,i):(e=i,r+1),o=t.filter;e<a;e++)~Z.indexOf(n[e])||y(n[e],t.draggable,u,!1)&&(o&&(typeof o==`function`?o.call(d,c,n[e],d):o.split(`,`).some(function(t){return y(n[e],t.trim(),u,!1)}))||(x(n[e],t.selectedClass,!0),Z.push(n[e]),ue({sortable:d,rootEl:l,name:`select`,targetEl:n[e],originalEvent:c})))}()):dt=X,Y=m)),ht&&this.isMultiDrag&&($=!1,(u[P].options.sort||u!==l)&&1<Z.length&&(a=E(X),o=k(X,`:not(.`+this.options.selectedClass+`)`),!mt&&t.animation&&(X.thisAnimationDuration=null),m.captureAnimationState(),mt||(t.animation&&(X.fromRect=a,Z.forEach(function(e){var t;e.thisAnimationDuration=null,e!==X&&(t=$?E(e):a,e.fromRect=t,m.addAnimationState({target:e,rect:t}))})),_t(),Z.forEach(function(e){n[o]?u.insertBefore(e,n[o]):u.appendChild(e),o++}),p===k(X)&&(s=!1,Z.forEach(function(e){e.sortableIndex!==k(e)&&(s=!0)}),s&&(f(`update`),f(`sort`)))),Z.forEach(function(e){ae(e)}),m.animateAll()),Y=m),(l===u||e&&e.lastPutMode!==`clone`)&&Q.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}))},nullingGlobal:function(){this.isMultiDrag=ht=!1,Q.length=0},destroyGlobal:function(){this._deselectMultiDrag(),g(document,`pointerup`,this._deselectMultiDrag),g(document,`mouseup`,this._deselectMultiDrag),g(document,`touchend`,this._deselectMultiDrag),g(document,`keydown`,this._checkKeyDown),g(document,`keyup`,this._checkKeyUp)},_deselectMultiDrag:function(e){if(!(ht!==void 0&&ht||Y!==this.sortable||e&&y(e.target,this.options.draggable,this.sortable.el,!1)||e&&e.button!==0))for(;Z.length;){var t=Z[0];x(t,this.options.selectedClass,!1),Z.shift(),ue({sortable:this.sortable,rootEl:this.sortable.el,name:`deselect`,targetEl:t,originalEvent:e})}},_checkKeyDown:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},r(e,{pluginName:`multiDrag`,utils:{select:function(e){var t=e.parentNode[P];t&&t.options.multiDrag&&!~Z.indexOf(e)&&(Y&&Y!==t&&(Y.multiDrag._deselectMultiDrag(),Y=t),x(e,t.options.selectedClass,!0),Z.push(e))},deselect:function(e){var t=e.parentNode[P],n=Z.indexOf(e);t&&t.options.multiDrag&&~n&&(x(e,t.options.selectedClass,!1),Z.splice(n,1))}},eventProperties:function(){var e=this,t=[],n=[];return Z.forEach(function(r){var i;t.push({multiDragElement:r,index:r.sortableIndex}),i=$&&r!==X?-1:$?k(r,`:not(.`+e.options.selectedClass+`)`):k(r),n.push({multiDragElement:r,index:i})}),{items:a(Z),clones:[].concat(Q),oldIndicies:t,newIndicies:n}},optionListeners:{multiDragKey:function(e){return(e=e.toLowerCase())===`ctrl`?e=`Control`:1<e.length&&(e=e.charAt(0).toUpperCase()+e.substr(1)),e}}})}),q})})),ee=c(b(),1),x=class{sortableInstances=[];log=new u(`dnd-manager`,`#7fff65`);constructor(e){this.plugin=e}toggleDragging(){this.sortableInstances.forEach(e=>e.option(`disabled`,!this.plugin.settings.draggingEnabled))}makeSortable(e){this.log.info(`Initializing Sortable on`,e);let t=null,n=new ee.default(e,{group:`nested`,draggable:`.tree-item`,chosenClass:`manual-sorting-chosen`,ghostClass:`manual-sorting-ghost`,animation:100,swapThreshold:2,fallbackOnBody:!0,disabled:!this.plugin.settings.draggingEnabled,delay:100,delayOnTouchOnly:!0,setData:function(e){e.setData(`string`,`text/plain`),e.setData(`string`,`text/uri-list`),e.effectAllowed=`all`},onChoose:e=>{this.log.info(`Sortable: onChoose`);let t=e.item;this.adjustSwapThreshold(t,n)},onStart:e=>{this.log.info(`Sortable: onStart`);let n=e.item.firstChild?.getAttribute(`data-path`)||``;if(this.plugin.app.vault.getAbstractFileByPath(n)instanceof l.TFolder){let e=this.plugin.getFileExplorerView().fileItems[n];e.setCollapsed(!0,!0),t||=e.setCollapsed.bind(e),e.setCollapsed=()=>void 0}},onChange:e=>{this.log.info(`Sortable: onChange`);let t=e.item;this.adjustSwapThreshold(t,n)},onEnd:e=>this.handleDragEnd(e,t),onUnchoose:()=>{if(this.log.info(`Sortable: onUnchoose`),this.plugin.settings.draggingEnabled)try{let e=new DragEvent(`drop`,{bubbles:!0,cancelable:!0,dataTransfer:new DataTransfer});document.dispatchEvent(e)}catch{}}});this.sortableInstances.push(n)}handleDragEnd(e,t){this.log.info(`Sortable: onEnd`);let n=document.querySelector(`.is-being-dragged-over`),r=e.item.firstChild?.getAttribute(`data-path`)||``,i=(n?.firstChild)?.getAttribute(`data-path`),a=i||e.to.previousElementSibling?.getAttribute(`data-path`)||`/`,o=this.plugin.app.vault.getAbstractFileByPath(r);if(!o){this.log.warn(`Dragged item not found in vault: ${r}`);return}let s=this.plugin.app.vault.getFolderByPath(a)?.isRoot()?``:a+`/`,c=s+o.name;r!==c&&this.plugin.app.vault.getAbstractFileByPath(c)&&(this.log.warn(`Name conflict detected. Path: ${c} already exists. Resolving...`),c=this.generateUniqueFilePath(c,o,s),this.log.info(`New item path:`,c));let u=i?this.plugin.settings.newItemsPosition===`top`?0:1/0:typeof e.newDraggableIndex==`number`?e.newDraggableIndex:0;this.plugin.orderManager.moveFile(r,c,u),this.plugin.app.fileManager.renameFile(o,c);let d=this.plugin.getFileExplorerView();if(o.path===c&&(this.log.warn(`Calling onRename manually for`,o,c),d.onRename(o,r)),o instanceof l.TFolder){let e=d.fileItems[r];t&&(e.setCollapsed=t)}if(!l.Platform.isMobile){let t=e.item.querySelector(`.tree-item-self`);if(!t)return;let n=new MouseEvent(`mouseover`,{bubbles:!0,cancelable:!0});t.dispatchEvent(n),document.querySelector(`.tree-item-self.hovered`)?.classList.remove(`hovered`),t.classList.add(`hovered`),t.addEventListener(`mouseleave`,()=>t.classList.remove(`hovered`),{once:!0})}}adjustSwapThreshold(e,t){let n=e.previousElementSibling,r=e.nextElementSibling,i=[];n?.classList.contains(`nav-folder`)&&i.push(n),r?.classList.contains(`nav-folder`)&&i.push(r),i.length>0?(t.options.swapThreshold=.3,i.forEach(e=>{let t=e.querySelector(`.tree-item-children`);t&&this.makeSortable(t)})):t.options.swapThreshold=2}generateUniqueFilePath(e,t,n){let r=t.name,i=r.lastIndexOf(`.`),a=i===-1?r:r.slice(0,i),o=i===-1?``:r.slice(i+1),s=e,c=1;for(;this.plugin.app.vault.getAbstractFileByPath(s);)s=n+`${a} ${c}${o?`.`+o:``}`,c++;return s}},S=c(b(),1),C=class{explorerUninstallers=[];menuUninstaller=null;dndManager;log=new u(`patcher`,`#65a3ff`);recentExplorerAction=``;constructor(e){this.plugin=e,this.dndManager=new x(e)}patchSortable(){let e=this;v(S.default.prototype,{_onDragOver:t=>function(n){if(!this.el.children.length){e.log.warn(`Container is empty, skipping onDragOver()`);return}return t.call(this,n)}})}patchFileExplorer(){let e=this,t=this.plugin,n=t.getFileExplorerView();this.explorerUninstallers.push(v(Object.getPrototypeOf(n.tree.infinityScroll.rootEl.childrenEl),{setChildrenInPlace:n=>function(r){let i=!!this.closest(`[data-type="file-explorer"]`),a=this.classList.value.includes(`tree-item`)&&this.classList.value.includes(`nav-`);if(!t.isManualSortingEnabled()||!a&&!i){n.apply(this,[r]);return}let o=Array.from(this.children),s=new Set(r);for(let n of o){let r=n;if(!s.has(r)){let i=r.firstElementChild?.getAttribute(`data-path`);if(i&&r.classList.contains(`tree-item`)){let a=t.app.vault.getAbstractFileByPath(i);if(!a)e.log.warn(`Item not exists in vault, removing its DOM element:`,i),i&&t.orderManager.updateOrder(),this.removeChild(n);else{let n=r.parentElement?.previousElementSibling?.getAttribute(`data-path`)||`/`;a.parent?.path!==n&&!t.settings.draggingEnabled&&(e.log.warn(`Item not in the right place, removing its DOM element:`,i),this.removeChild(r),t.getFileExplorerView().updateShowUnsupportedFiles())}}}}let c=n=>{let r=n.firstChild?.getAttribute(`data-path`);e.log.info(`Processing item`,n,r);let i=this,a=r?.substring(0,r.lastIndexOf(`/`))||`/`;e.log.info(`Item container:`,i,a),r&&!t.settings.customFileOrder[a].includes(r)&&(e.log.info(`Item not found in custom order, updating order...`),t.orderManager.updateOrder());let o=new Map(t.settings.customFileOrder[a].map((e,t)=>[e,t])),s=[...i.children].find(e=>{let t=e.firstElementChild?.getAttribute(`data-path`);return!t||!r?!1:(o.get(t)??-1)>(o.get(r)??-1)})??null;this.insertBefore(n,s),e.log.info(`Inserted item:`,n,`Before:`,s),S.default.get(i)||e.dndManager.makeSortable(i)};for(let e of r)this.contains(e)||(e.classList.contains(`tree-item`)?e.firstChild?.hasAttribute(`data-path`)?c(e):new MutationObserver((t,n)=>{for(let r of t)if(r.attributeName===`data-path`){c(e),n.disconnect();return}}).observe(e.firstChild,{attributes:!0,attributeFilter:[`data-path`]}):this.prepend(e))},detach:e=>function(){if(!t.isManualSortingEnabled()){e.apply(this);return}let n=this.firstChild,r=n instanceof HTMLElement?n.getAttribute(`data-path`):``;if(!t.app.vault.getAbstractFileByPath(r||``)){e.apply(this);return}}})),this.explorerUninstallers.push(v(Object.getPrototypeOf(n),{onRename:e=>function(n,r){if(e.apply(this,[n,r]),t.isManualSortingEnabled()){let e=r.substring(0,r.lastIndexOf(`/`))||`/`;!t.settings.draggingEnabled&&e!==n.parent?.path&&t.orderManager.moveFile(r,n.path,t.settings.newItemsPosition===`top`?0:1/0),t.orderManager.renameItem(r,n.path)}},setSortOrder:n=>function(r){n.call(this,r);let i=t.isManualSortingEnabled();t.settings.selectedSortOrder=r,e.log.info(`Sort order changed to:`,r),i&&t.explorerManager.refreshExplorer(),t.saveSettings()},sort:n=>function(){t.isManualSortingEnabled()&&(e.recentExplorerAction=`sort`),n.apply(this)},onFileMouseover:e=>function(n,r){if(t.isManualSortingEnabled()){let e=document.querySelector(`.manual-sorting-chosen`);e&&(r=e)}e.apply(this,[n,r])}})),this.explorerUninstallers.push(v(Object.getPrototypeOf(n.tree),{setFocusedItem:n=>function(r,i){t.isManualSortingEnabled()&&(e.recentExplorerAction=`setFocusedItem`),n.apply(this,[r,i])},handleItemSelection:e=>function(n,r){if(!t.isManualSortingEnabled()){e.apply(this,[n,r]);return}function i(e,n,r){let i=e.indexOf(n),a=e.indexOf(r);if(i===-1||a===-1)return[];let o=Math.min(i,a),s=Math.max(i,a);return e.slice(o,s+1).map(e=>t.getFileExplorerView().fileItems[e])}let a=this,o=a.selectedDoms,s=a.activeDom,c=a.view;if(!l.Keymap.isModEvent(n)){if(n.altKey&&!n.shiftKey)return this.app.workspace.setActiveLeaf(c.leaf,{focus:!0}),o.has(r)?this.deselectItem(r):(this.selectItem(r),this.setFocusedItem(r,!1),this.activeDom=r),!0;if(n.shiftKey){this.app.workspace.setActiveLeaf(c.leaf,{focus:!0});let e=t.orderManager.getFlattenPaths(),n=s?i(e,s.file.path,r.file.path):[r];for(let e=0,t=n;e<t.length;e++){let n=t[e];this.selectItem(n)}return!0}if(r.selfEl.hasClass(`is-being-renamed`))return!0;if(r.selfEl.hasClass(`is-active`))return this.app.workspace.setActiveLeaf(c.leaf,{focus:!0}),this.setFocusedItem(r,!1),!0}return this.clearSelectedDoms(),this.setFocusedItem(void 0),this.activeDom=r,!1}})),this.explorerUninstallers.push(v(Object.getPrototypeOf(n.tree.infinityScroll),{scrollIntoView:n=>function(r,...i){let a=r.el,o=!!a.closest(`[data-type="file-explorer"]`);if(!t.isManualSortingEnabled()||!o){n.apply(this,[r,...i]);return}if(e.recentExplorerAction){e.recentExplorerAction=``;return}let s=this.scrollEl,c=a.offsetTop-s.offsetTop-s.clientHeight*.3+a.clientHeight/2;s.scrollTo({top:c,behavior:`smooth`})}}))}patchSortOrderMenu(){let e=this,t=this.plugin;this.menuUninstaller=v(l.Menu.prototype,{showAtMouseEvent:n=>function(...r){let i=r[0].target;if(i.getAttribute(`aria-label`)===i18next.t(`plugins.file-explorer.action-change-sort`)&&i.classList.contains(`nav-action-button`)){let n=this;if(t.isManualSortingEnabled()){let e=n.items.find(e=>e instanceof l.MenuItem&&e.checked===!0);e&&e.setChecked(!1)}let r=m;n.addItem(e=>{e.setTitle(`Manual sorting`).setIcon(`pin`).setChecked(t.isManualSortingEnabled()).setSection(r).onClick(()=>{t.isManualSortingEnabled()||(t.settings.selectedSortOrder=m,t.saveSettings(),t.orderManager.updateOrder(),t.explorerManager.refreshExplorer())})}),t.isManualSortingEnabled()&&n.addItem(n=>{n.setTitle(`Dragging`).setIcon(`move`).setSection(r).onClick(()=>{t.settings.draggingEnabled=!t.settings.draggingEnabled,t.saveSettings(),e.dndManager.toggleDragging()});let i=n.dom.createEl(`div`,{cls:`menu-item-icon dragging-enabled-checkbox`}).createEl(`input`,{type:`checkbox`});i.checked=t.settings.draggingEnabled}),n.addItem(e=>{e.setTitle(`Reset order`).setIcon(`trash-2`).setSection(r).onClick(()=>{let e=t.getFileExplorerView().sortOrder;new f(t.app,e,()=>{t.orderManager.resetOrder(),t.orderManager.updateOrder(),t.isManualSortingEnabled()&&t.explorerManager.refreshExplorer()}).open()})});let i=n.items,a=i.splice(8,1)[0];i.splice(0,0,a)}return n.apply(this,r)}})}unpatchFileExplorer(){this.explorerUninstallers.length&&(this.explorerUninstallers.forEach(e=>e()),this.explorerUninstallers=[],this.log.info(`File explorer unpatched`))}unpatchSortOrderMenu(){this.menuUninstaller&&(this.menuUninstaller(),this.menuUninstaller=null,this.log.info(`Sort order menu unpatched`))}},w=class{constructor(e){this.plugin=e}log=new u(`explorer-manager`,`#bf77ff`);async waitForExplorerElement(){return new Promise(e=>{this.observeExplorerMount(e,!0)})}refreshExplorerOnMount=()=>this.observeExplorerMount(()=>void this.refreshExplorer(!1));async refreshExplorer(e=!0){e&&await this.reloadExplorerPlugin(),this.updateManualSortingClass(),this.setupAutoScrolling(),this.addAppReloadButton(),this.reloadFolderNotesPlugin()}observeExplorerMount(e,t=!1){let n=document.querySelector(`[data-type="file-explorer"] .nav-files-container`);if(n instanceof HTMLElement){e(n);return}new MutationObserver((n,r)=>{for(let i of n)for(let n of i.addedNodes)if(n instanceof HTMLElement&&n.matches(`[data-type="file-explorer"] .nav-files-container`)){t&&r.disconnect(),this.log.info(`File Explorer mounted`,n),e(n);return}}).observe(document.querySelector(`.workspace`)??document.body,{childList:!0,subtree:!0})}async reloadExplorerPlugin(){let e=this.plugin.app.internalPlugins.plugins[`file-explorer`];e.disable(),await e.enable(),this.log.info(`File Explorer plugin reloaded`)}async updateManualSortingClass(){(await this.waitForExplorerElement()).toggleClass(`manual-sorting-enabled`,this.plugin.isManualSortingEnabled())}async setupAutoScrolling(){if(!this.plugin.isManualSortingEnabled())return;let e=null,t=await this.waitForExplorerElement(),n=n=>{if(e)return;let r=()=>{t.scrollTop+=n,e=requestAnimationFrame(r)};e=requestAnimationFrame(r)},r=()=>{e&&=(cancelAnimationFrame(e),null)},i=e=>{e.preventDefault();let i=t.getBoundingClientRect();e.clientY<i.top+50?n(-5):e.clientY>i.bottom-50?n(5):r()};t.removeEventListener(`dragover`,i),this.plugin.isManualSortingEnabled()&&(t.addEventListener(`dragover`,i),document.addEventListener(`dragend`,r),document.addEventListener(`drop`,r),document.addEventListener(`mouseleave`,r))}async addAppReloadButton(){}async reloadFolderNotesPlugin(){this.plugin.app.plugins.getPlugin(`folder-notes`)&&(this.log.info(`Reloading Folder Notes plugin`),await this.plugin.app.plugins.disablePlugin(`folder-notes`),this.plugin.app.plugins.enablePlugin(`folder-notes`))}},T=class extends l.Plugin{orderManager;patcher=new C(this);explorerManager=new w(this);log=new u(`core`,`#ff4e37`);settings;async onload(){await this.loadSettings(),this.setLogLevel(this.settings.debugMode?`debug`:`silent`),this.addSettingTab(new d(this.app,this)),this.app.workspace.onLayoutReady(()=>this.initialize())}onunload(){this.patcher.unpatchFileExplorer(),this.patcher.unpatchSortOrderMenu(),this.isManualSortingEnabled()&&this.explorerManager.refreshExplorer()}async initialize(){let e=this.isManualSortingEnabled();this.patcher.patchSortable(),this.patcher.patchSortOrderMenu(),await this.explorerManager.waitForExplorerElement();let t=this.getFileExplorerView();e||t.setSortOrder(this.settings.selectedSortOrder),this.patcher.patchFileExplorer(),this.orderManager=new p(this),this.orderManager.updateOrder(),this.isManualSortingEnabled()&&await this.explorerManager.refreshExplorer(),this.explorerManager.refreshExplorerOnMount()}async loadSettings(){this.settings={..._,...await this.loadData()},this.log.info(`Settings loaded:`,this.settings)}async saveSettings(){await this.saveData(this.settings),this.log.info(`Settings saved:`,this.settings)}async onExternalSettingsChange(){await this.loadSettings(),this.log.warn(`Settings changed externally`),this.isManualSortingEnabled()&&this.explorerManager.refreshExplorer()}getFileExplorerView=()=>this.app.workspace.getLeavesOfType(`file-explorer`)[0].view;isManualSortingEnabled=()=>this.settings.selectedSortOrder===m;setLogLevel(e){u.logLevel=e,e===`debug`&&(this.settings.debugMode=!0,this.saveSettings())}};module.exports=T;
/* nosourcemap */